<my-datepicker [date]="currentDate" [onChange]="onChange()" [mode]="mode"></my-datepicker>
<br />
<div class="row choicePeriod">
    <div class="col-xs-4">
        <button class="btn btn-primary-light btn-block" (click)="modeDay();refreshPlanning();">Jour</button>
    </div>
    <div class="col-xs-4">
        <button class="btn btn-primary-light btn-block" (click)="modeWeek();refreshPlanning();">Semaine</button>    
    </div>
    <div class="col-xs-4">
        <button class="btn btn-primary-light btn-block" (click)="modeMonth();refreshPlanning();">Mois</button>    
</div>


</div>

<table class="calendar" *ngIf="mode != 'month'" style="width:100%">
    <tr>
        <th style="max-width:80px">Horaire</th>
        <th class="text-center" *ngFor="let d of days">{{d | date: 'dd/MM'}}</th>
    </tr>
    <tr *ngFor="let hour of hours;let i=index" [ngClass]="showHour(hour) ? 'full-hour' : 'not-full-hour'">
        <td class="planning-cell col-xs-1" style="max-width:80px">
            <!--<span  *ngIf="showHour(hour)">{{hour}}h</span>-->
            <span>{{hour}}h</span>
        </td>
        

        <td *ngFor="let d of days;let j=index"> 
            <app-calendar-details [hour]="hour" [day]="d" [state]="availableSession(j,i)"></app-calendar-details>                      
            <!--<div *ngIf="planning && planning[j][i]" style="position:relative;top:-5px;left:0px;right:0px;">
                <div class="game-session {{ planning[j][i].is_free ? 'free' : ''}}" style="bottom:-56px">
                    <div *ngIf="planning[j][i].is_free">
                        <a class="reservation-link" [routerLink]="['/reservation']">Réserver</a>
                    </div>
                    <div *ngIf="!planning[j][i].is_free">Indisponible</div>
                </div>
            </div>-->
        </td>
    </tr>
</table>

<table class="month-calendar" *ngIf="mode == 'month'">
    <tr>
        <th class="text-center" *ngFor="let i of DAY_OF_WEEK">{{i}}</th>
    </tr>
    <tr *ngFor="let w of monthWeeks;let i = index">
        <td *ngFor="let d of w; let j = index">
            <div class="calendar-day {{d.getMonth() == currentDate.getMonth() ? 'current-month' : ''}} {{d.getTime() == currentDate.getTime() ? 'today' : ''}}">
                {{d.getDate()}} <span *ngIf="d.getDate() == 1">{{d | date:'MMM'}}</span>
            </div>

            <div *ngIf="planning">
                <div *ngFor="let p of planning[i*7+j]">
                    <div *ngIf="p" class="game-session {{p.is_free ? 'free' : ''}}">
                        <div *ngIf="p.is_free">
                            <a class="reservation-link" [routerLink]="['/reservation']">{{p.hour_start.substring(11, 16)}} : Réserver</a>
                        </div>
                        <div *ngIf="!p.is_free">{{p.hour_start.substring(11, 16)}}</div>
                    </div>
                </div>
            </div>
        </td>
    </tr>
</table>
<br />

<fieldset>
    <legend>Debug</legend>
    Test : {{ monthWeeks | json}}
    Room :
    <pre>{{room | json}}</pre>
    Planning :
    <pre>{{planning | json}}</pre>
</fieldset>

